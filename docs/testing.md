# Testing K4A

## Test Categories

The K4A repo has four categories of tests

* Unit tests
* Functional tests
* Stress tests
* Perf tests
* Firmware tests

### Unit Tests

Unit tests are tests which run on the build machine. They must be very quick
(~ <1s), be reproducible, and not require hardware. Unit tests are built
using the GoogleTest framework. For a basic example of writing a unit test
please see
[tests/UnitTests/errors_ut/errors_ut.cpp](../tests/UnitTests/errors_ut/errors_ut.cpp).
After compiling, unit tests can be run using "ctest -L unit" in the build
directory. Unit tests are run as part of the CI system.

### Functional Tests

Functional tests are tests which run on the test machine. They must be quick
(~ <10s), be reproducible, and may require hardware. Functional tests are
built using the GoogleTest framework. For a basic example of writing a
functional test please see
[tests/example/test.cpp](../tests/example/test.cpp). After compiling,
functional tests can be run using "ctest -L functional" in the build
directory. Functional tests are run as part of the CI system.

### Stress Tests

Stress tests are tests which run the same logic repeatedly to check for
crashes and statistical failures. These tests will be run on a rolling build
and may require hardware. Stress tests are built using the GoogleTest
framework. After compiling, stress tests can be run using "ctest -L stress"
in the build directory.

### Perf Tests

Perf tests are tests who results are purely statistics and not Pass/Fail.
These tests will be run on a rolling build and may require hardware. Perf
tests are built using the GoogleTest framework. After compiling, perf tests
can be run using "ctest -L perf" in the build directory.

### Firmware Tests

Firmware tests are used to validate new firmware drops. They are run manually
when a new firmware candidate is given and will require hardware. Firmware
tests are built using the GoogleTest framework. After compiling, firmware tests
can be run using "bin\firmware_fw.exe --firmware \<firmware path\>" in the build
directory.

## Running tests

These tests are built using the googletest framework. The easiest way to
invoke a single test is to run the test exectuable generated by the build.
This works great for rapid iteration on one test executable but does not
scale to running all tests.

To run all tests, use CTest. CTest has registered all tests and will execute
all test executables. However, CTest requires that the test exes are run on
the same machine they were built on.

To run tests on separate build machine, a test list file per test category. A
simple [python script](../scripts/RunTestList.py) is then used to invoke
those tests.